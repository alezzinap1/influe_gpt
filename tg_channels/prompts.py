# telegram_prompts.py
"""
Промпты для всех этапов tg-пайплайна:
- годовые рыночные саммари
- квартальные рыночные саммари
- авторские (стилистические) квартальные саммари
- авторские годовые саммари
- финальный многослойный отчёт об авторе
"""

YEAR_SUMMARY_PROMPT = """Ты — профессиональный аналитик Telegram-каналов с опытом обзоров финансовых и крипто-авторов.

Тебе даны все сообщения из канала "{channel}" за {year} год.

Твоя задача — написать ровно 4 абзаца связного русского текста (без списков, заголовков, маркеров и лишней воды), который даёт цельное саммари года.

Структура саммари должна естественно охватывать следующие аспекты (не обязательно в отдельные абзацы и не перечисляя их):

1. Ключевые темы, которые формировали контент автора в этом году.
2. Общий взгляд автора на рынок (бычий/медвежий/нейтральный, его характер и уверенность).
3. Как менялись взгляды и настроения автора в течение года (с указанием примерных периодов, если были заметные сдвиги).
4. Самые важные события, решения или действия автора, а также все значимые названия проектов/активов/компаний, которые упоминались в канале (перечисли через запятую в подходящем месте текста).

Сначала кратко проанализируй сообщения шаг за шагом:
- Выдели основные повторяющиеся темы.
- Определи преобладающий тон по отношению к рынку.
- Отметь ключевые изменения взглядов по месяцам или кварталам.
- Составь список важных событий, действий и упомянутых названий.

Затем, на основе этого анализа, напиши финальное саммари в 4 абзацах.

СООБЩЕНИЯ КАНАЛА ЗА {year} ГОД:

{messages}
"""

QUARTER_SUMMARY_PROMPT = """Ты — профессиональный аналитик финансовых и крипто-TG-каналов с глубоким пониманием трейдинга, риск-менеджмента и рыночных нарративов.

Тебе даны все сообщения из канала "{channel}" за {year} год, квартал Q{quarter}.

Твоя задача — написать ровно 3 абзаца связного русского текста (без списков, маркеров, заголовков и лишней воды), которые дают краткое, но максимально конкретное и информативное саммари квартала.

Текст должен естественно и подробно осветить следующие аспекты (не перечисляя их явно):

1. Конкретные рыночные события, сделки, сетапы и торговые идеи, на которые автор делал основной упор в этом квартале (с указанием активов, уровней или тайминга, где возможно).
2. Оценка автором рынка в этот период: чего он ждал, чего опасался, как относился к риску и волатильности, какой общий тон преобладал (бычий, медвежий, осторожный).
3. Перспективные активы или сектора, которые автор выделял, а также реальные действия (входы, выходы, хеджирование, ребалансинг). Отметь любые заметные изменения настроения, тактики или фокуса внутри квартала (с привязкой к месяцам или событиям, если они были).

Перед написанием финального текста сначала кратко проанализируй сообщения шаг за шагом:
- Выдели все упоминаемые рыночные события, сделки, сетапы и идеи с активами.
- Определи преобладающий тон и отношение к риску, отметь ключевые цитаты или формулировки.
- Составь список перспективных активов/секторов и действий автора.
- Зафиксируй любые сдвиги настроения или тактики внутри квартала (по месяцам или триггерам).

Затем, на основе этого анализа, напиши финальное саммари в ровно 3 абзацах с максимальной конкретикой.

СООБЩЕНИЯ КАНАЛА ЗА Q{quarter} {year} ГОДА:

{messages}
"""

AUTHOR_QUARTER_PROMPT = """Ты — опытный литературный критик и аналитик авторского стиля с большим опытом разбора блогов, Telegram-каналов и личных медиа трейдеров, инфобизнесменов и публичных фигур.

Тебе даны все сообщения из канала "{channel}" за {year} год, квартал Q{quarter}.

Твоя задача — создать глубокое стилистическое портрет-саммари автора за этот период. 
Полностью игнорируй рыночные события и позиции как таковые — используй их только как фон для анализа того, КАК автор пишет и подаёт себя.

Напиши связный русский текст объёмом 5–7 абзацев без маркеров, списков и нумерованных пунктов.
Текст должен естественно и последовательно осветить все следующие аспекты (можно объединять близкие, но ничего не пропускать):

• Тон и роль, которую автор себе приписывает (друг, гуру, циник, шутник, учитель, жертва обстоятельств и т.д.). Как он выстраивает дистанцию с читателем, какие маски надевает. Приведи характерные формулировки, по которым это видно.

• Структура повествования и типичный шаблон постов: как автор ведёт мысль (от личной истории к выводу, от тезиса к примерам, через эмоциональный rant, через storytelling с зачином-конфликтом-развязкой и т.д.).

• Риторические приёмы воздействия: шутки и самоирония, троллинг, драматизация, преувеличения, прямые обращения к читателю, риторические вопросы, императивы, личные исповеди («я тоже сливал миллион»), эмоциональные триггеры. Опиши, как эти приёмы удерживают внимание и вызывают нужные эмоции.

• Лексика и устойчивые формулы: уровень грубости/мата, любимый сленг (крипто, трейдерский, инфоцыганский, игровой), англицизмы. Приведи 5–10 коротких характерных фраз или словосочетаний, которые автор часто повторяет и по которым его легко узнать (например: «вот это поворот», «без иллюзий», «гринд не останавливается»).

• Общий образ и идентичность, который складывается у читателя: выживший после краха, маньяк гринда, усталый романтик, проповедник, бунтарь и т.д. На какие архетипы и чувства он давит (FOMO, жажда признания, желание принадлежности к «своим», страх остаться за бортом и пр.).

Перед написанием финального текста сначала проведи внутренний анализ шаг за шагом:
- Собери примеры, иллюстрирующие тон и роль автора.
- Выдели 3–5 типичных структур постов.
- Зафиксируй все заметные риторические приёмы с примерами.
- Составь список повторяющихся слов, формул и сленга.
- Сформулируй, какой общий образ и эмоциональные триггеры преобладают.

Затем, опираясь только на этот анализ, напиши финальное стилистическое саммари как цельный связный текст.

СООБЩЕНИЯ КАНАЛА ЗА Q{quarter} {year} ГОДА:

{messages}
"""

AUTHOR_YEAR_PROMPT = """Ты — опытный литературный критик, аналитик нарратива и психолингвист с глубоким стажем разбора личных медиа публичных фигур, трейдеров и инфлюенсеров.

Тебе даны стилистические саммари по четырём кварталам Telegram-канала "{channel}" за {year} год.

Твоя задача — создать цельный годовой мета-анализ именно АВТОРА и его письма как личности. 
Работай только на основе предоставленных квартальных саммари, не добавляй внешних предположений.

Напиши связный русский текст объёмом 5–8 абзацев (без списков, маркеров, нумерованных пунктов и подзаголовков).
Текст должен быть синтетическим: фокус на выводах, паттернах и формулировках, а не на хронологическом пересказе кварталов.
Где уместно, приводи короткие характерные фразы или формулы из квартальных саммари как иллюстрации.

Текст должен естественно и полно осветить все следующие аспекты (можно объединять близкие, но ничего не пропускать):

• Эволюция тона и роли автора в течение года: как менялись уверенность, ирония, агрессия, усталость, надлом; как трансформировались архетипы (гуру → циник → жертва → триумфатор и т.д.).

• Устойчивые риторические приёмы и "якоря" вовлечения, которые автор использовал стабильно: типичные сюжеты в сторителлинге, исповедальные вставки, поиск врага/троллинг, повторяющиеся мантры и лозунги. Объясни механизм их воздействия на аудиторию.

• Авторский лексический код: характерные группы слов (мат, сленг, англицизмы, жаргон, мемы), устойчивые короткие фразы и словосочетания, которые создают узнаваемость. Как этот код формирует образ автора в глазах читателя.

• Годовой большой нарратив и идентичность: какой сквозной сюжет автор выстраивал в этом году (например, "борьба с выгоранием и возвращение", "путь к настоящему профиту", "разоблачение иллюзий рынка"). Как он позиционирует себя в этом сюжете (герой, антигерой, учитель, наблюдатель). Какие доминирующие эмоциональные состояния проявляются (азарт, тревога, злость, благодарность, усталость).

• Механизмы удержания аудитории и уникальность подачи: за счёт чего читатель остаётся (чувство причастности, радикальная честность, юмор, обещание "большой игры", эмоциональные качели). Что особенно отличает стиль этого автора от типичных крипто- или трейдерских каналов.

Перед написанием финального текста проведи внутренний анализ шаг за шагом:
- Сравни тон, роль и эмоциональные состояния по кварталам — выдели моменты эволюции и стабильности.
- Выдели риторические приёмы и фразы, которые встречаются в нескольких кварталах (устойчивые "якоря").
- Определи повторяющиеся лексические паттерны и формулы.
- Сформулируй сквозной годовой нарратив и архетипическую позицию автора.
- Оцени ключевые драйверы вовлечения и уникальные черты стиля.

Затем, опираясь исключительно на этот анализ, напиши финальное мета-портрет как цельный связный текст.

СТИЛИСТИЧЕСКИЕ САММАРИ ПО КВАРТАЛАМ ЗА {year} ГОД:

{quarter_summaries}
"""

AUTHOR_REPORT_PROMPT = """Ты — старший аналитик личных крипто- и трейдерских Telegram-каналов с экспертизой в психолингвистике, нарративном анализе и поведенческой экономике.

Тебе даны все доступные квартальные и годовые саммари по контенту (рынок, риск, позиции) и стилю канала "{channel}".

Твоя задача — подготовить финальный компактный аналитический отчёт об авторе и его канале объёмом 900–1200 слов.
Отчёт должен быть исключительно синтетическим: новые выводы и формулировки на основе предоставленных саммари, без прямого копирования больших кусков текста.

Структура строго с этими подзаголовками (жирный шрифт):

**Идентичность автора**  
2–3 основных архетипа. Ключевые внутренние противоречия. Сквозной личный нарратив года.

**Стиль письма**  
Преобладающий тон. Типичный шаблон поста (зачин → разбор → вывод/мантра). Три наиболее ярких риторических приёма с конкретными примерами из саммари (сторителлинг, исповедь, троллинг и т.п.).

**Лексика и сигнатурный код**  
Характеристики словаря: уровень мата, сленг, англицизмы, мемы, жаргон. 6–8 самых узнаваемых коротких фраз или формул. Как этот код усиливает образ автора.

**Механизмы вовлечения и удержания**  
3–4 главных эмоциональных триггера (FOMO, чувство вины, братство, превосходство и т.д.). Конкретные приёмы удержания внимания (риторические вопросы, прямые призывы, провокации, клиффхенгеры).

**Эволюция и риски**  
• По рынку и риску: три ключевых тезиса об изменении взглядов (бычность/медвежность, отношение к риску, фокусные экосистемы).  
• По стилю: две основные линии развития тона и структуры письма.  
• Сильные и слабые стороны: три пункта (по рыночному чутью, стилю подачи и потенциальным рискам для читателя/фолловера).

Пиши только по-русски. Стиль: тезисный, плотный, без воды. 
Каждый абзац — одна чёткая идея + обязательный конкретный пример (фраза, схема поста, приём).
Используй только информацию из предоставленных саммари.

Перед написанием отчёта сначала проведи внутренний анализ:
- Сопоставь рыночные и стилистические саммари: где тон автора коррелирует с его рыночным взглядом.
- Выдели устойчивые элементы и моменты эволюции по кварталам/году.
- Зафиксируй все сигнатурные фразы, приёмы и триггеры с привязкой к источникам.
- Сформулируй 2–3 внутренних противоречия и главный нарратив.
- Оцени сильные/слабые стороны с учётом влияния на аудиторию.

Затем напиши финальный отчёт, строго следуя структуре и ограничениям.

САММАРИ ДЛЯ АНАЛИЗА:

{summaries}
"""

AUTHOR_REPORT_IDENTITY_STYLE_PROMPT = """Ты — старший аналитик личных крипто- и трейдерских Telegram-каналов с экспертизой в психолингвистике, нарративном анализе и механизмах вовлечения аудитории.

Тебе даны все доступные квартальные и годовые саммари по контенту и стилю канала "{channel}".

Твоя задача — подготовить ультракомпактный аналитический отчёт (всего 3–4 абзаца) исключительно об идентичности автора, его стиле письма и механизмах вовлечения.
Отчёт должен быть синтетическим: новые формулировки и выводы на основе саммари, без прямого копирования больших фрагментов.

Структура строго с этими подзаголовками (жирный шрифт):

**Идентичность автора**  
(1 абзац) 2–3 ключевых архетипа, основные внутренние противоречия и сквозной личный нарратив года. Обязательно 1–2 примера из саммари.

**Стиль и подача**  
(1 абзац) Преобладающий тон, типичный шаблон поста и три наиболее ярких риторических приёма. Для каждого приёма — короткий конкретный пример (фраза или схема).

**Лексика и механизмы вовлечения**  
(1–2 абзаца) Характеристики словаря (уровень мата, сленг, англицизмы, мемы). 6–8 сигнатурных коротких формулировок. 2–3 главных приёма удержания внимания и эмоциональных триггера (FOMO, братство, провокация и т.д.) с примерами.

Пиши только по-русски. Стиль: предельно тезисный, плотный, без воды и общих слов.
Каждый абзац — одна центральная идея + 1–2 конкретных примера из саммари.

Перед написанием отчёта обязательно проведи внутренний анализ шаг за шагом:
- Сравни саммари по кварталам/году: выдели устойчивые архетипы и моменты их трансформации/противоречий.
- Сформулируй сквозной личный нарратив автора.
- Зафиксируй преобладающий тон, шаблон постов и топ-3 риторических приёма с примерами.
- Собери характерные элементы лексики, 6–8 самых узнаваемых формулировок и ключевые триггеры вовлечения.

Затем напиши финальный отчёт, строго следуя структуре и используя только результаты этого анализа.

САММАРИ ДЛЯ АНАЛИЗА:

{summaries}
"""

AUTHOR_REPORT_EVOLUTION_STRENGTHS_PROMPT = """Ты — старший аналитик трейдинговых дневников и личных медиа с экспертизой в долгосрочной эволюции взглядов, стиля и нарративов авторов.

Тебе даны все доступные квартальные и годовые саммари по содержанию (рынок, риск, позиции) и стилю канала "{channel}" (возможно, за несколько лет: 2022, 2023, 2024, 2025).

Твоя задача — подготовить ультракомпактный аналитический отчёт исключительно об эволюции и сильных/слабых сторонах автора.
Отчёт должен быть синтетическим: новые выводы на основе саммари, без пересказа хронологии событий.

Структура строго с этими подзаголовками (жирный шрифт). Общий объём — 4–6 коротких абзацев.

**Эволюция взглядов на рынок и риск**  
(1–2 абзаца) Для каждого года, по которому есть данные, дай отдельный тезис в строго таком формате:  
- 2022: 1–2 ключевых предложения о взглядах и отношении к риску.  
- 2023: 1–2 ключевых предложения...  
- 2024: 1–2 ключевых предложения...  
- 2025: 1–2 ключевых предложения...  
(Пропускай годы без данных.)  
Затем один обобщающий вывод по всей траектории (1 предложение).

**Эволюция стиля и нарратива**  
(1 абзац) 2–3 основные линии изменения тона, структуры текстов и длинные сюжетные дуги автора за весь период. Обязательно 1–2 характерных примера формулировок или приёмов.

**Сильные и слабые стороны автора**  
(1–2 абзаца)  
• 2–3 сильные стороны (рыночное мышление, стиль подачи, нарратив).  
• 2–3 слабые стороны и потенциальные риски для читателя (слепые зоны, эмоциональные искажения, манипулятивные приёмы и т.д.).  
Каждый пункт — с коротким обоснованием или примером.

Пиши только по-русски. Стиль: предельно тезисный, плотный, без воды и общих фраз. 
Все выводы опирай на конкретные паттерны из саммари.

Перед написанием отчёта обязательно проведи внутренний анализ шаг за шагом:
- Выдели по годам ключевые изменения взглядов на рынок и риск, отметь переломные моменты.
- Проследи линии эволюции тона, структуры и нарратива, сформулируй длинные сюжетные дуги.
- Сопоставь рыночные и стилистические изменения: где они коррелируют.
- Оцени сильные стороны (что делает автора убедительным и полезным) и слабые (где возможны ошибки или риски для фолловеров).
- Сформулируй обобщающий вывод по траектории.

Затем напиши финальный отчёт, строго следуя структуре и используя только результаты анализа.

САММАРИ ДЛЯ АНАЛИЗА:

{summaries}
"""
YEAR_EVOLUTION_PARAGRAPH_PROMPT = """Ты — старший аналитик трейдинговых дневников и личных медиа с экспертизой в эволюции взглядов и стиля авторов.

Тебе даны краткие саммари по содержанию (рынок, риск, позиции) и стилю канала "{channel}" за {year} год. 
Возможно, в саммари есть упоминания или сравнения с предыдущим годом.

Твоя задача — написать ровно один связный абзац (3–5 предложений) на русском языке, тезисно и без воды.
Абзац должен обязательно осветить три аспекта в логичной последовательности:

1. Общий взгляд автора на рынок и отношение к риску в {year} году (бычий/медвежий/осторожный, ключевые акценты).
2. Ключевые изменения во взглядах и подходе к риску по сравнению с предыдущим годом — только если такие изменения явно прослеживаются или упоминаются в саммари (иначе пропусти этот пункт или отметь стабильность).
3. Заметные изменения в стиле письма и подаче (тон, структура, риторика, эмоциональность) по сравнению с предыдущим периодом — снова только на основе данных.

Выводы должны быть синтетическими (новые формулировки), опираться исключительно на предоставленные саммари и содержать хотя бы один конкретный пример (фразу, приём или акцент).

Перед написанием абзаца кратко проанализируй шаг за шагом:
- Выдели преобладающий взгляд на рынок и риск в {year}.
- Проверь, есть ли в саммари явные указания на изменения по сравнению с предыдущим годом (по содержанию и стилю). Если нет — отметь стабильность или пропусти сравнение.
- Зафиксируй ключевые стилистические сдвиги и конкретные примеры.
- Сформулируй, как эти аспекты связаны между собой (если связь видна).

Затем напиши финальный абзац как цельный текст.

САММАРИ ЗА {year} ГОД:

{summaries}
"""
