# Вспомогательные утилиты

Описание утилит и скриптов для обслуживания проекта.

## Утилиты для работы с каналами

### `reindex_all.py` - Массовая переиндексация

Переиндексирует все каналы из БД или файлов.

**Использование:**
```bash
# Переиндексация всех каналов из БД
python reindex_all.py

# Переиндексация всех каналов из parquet файлов
python reindex_all.py --from-files
```

**Что делает:**
- Находит все каналы в БД или parquet файлы
- Переиндексирует каждый канал
- Показывает прогресс и результаты
- Сохраняет данные из БД и файлов

**Статус:** Полезная утилита, рекомендуется использовать при обновлении кода

---

### `fix_channels_db.py` - Исправление БД каналов

Нормализует имена каналов и удаляет дубликаты.

**Использование:**
```bash
python fix_channels_db.py
```

**Что делает:**
- Нормализует имена каналов (убирает @, приводит к нижнему регистру)
- Удаляет дубликаты каналов
- Синхронизирует с ChromaDB
- Выводит отчет о изменениях

**Статус:** Полезная утилита, использовать при проблемах с именами каналов

---

### `delete_channel.py` - Удаление канала

Удаляет канал из БД, ChromaDB и файлов.

**Использование:**
```bash
python delete_channel.py @channelname
```

**Что делает:**
- Удаляет канал из SQLite БД
- Удаляет чанки из ChromaDB
- Удаляет parquet файлы
- Удаляет саммари

**⚠️ Внимание:** Операция необратима!

**Статус:** Полезная утилита, использовать с осторожностью

---

### `sync_channel_status.py` - Синхронизация статуса

Синхронизирует статус каналов между SQLite БД и ChromaDB.

**Использование:**
```bash
# Синхронизировать все каналы
python sync_channel_status.py

# Синхронизировать конкретный канал
python sync_channel_status.py channelname

# Сбросить все флаги
python sync_channel_status.py --reset
```

**Что делает:**
- Проверяет соответствие каналов в БД и ChromaDB
- Обновляет статусы индексации
- Выводит отчет о расхождениях
- Может сбросить все флаги статуса

**Статус:** Полезная утилита, использовать при рассинхронизации

---

## Утилиты для проверки

### `check_imports.py` - Проверка импортов

Проверяет синтаксис и импорты всех Python файлов.

**Использование:**
```bash
python check_imports.py
```

**Что проверяет:**
- Синтаксис всех `.py` файлов
- Импорты легковесных модулей (без torch/sentence-transformers)
- Отсутствие критических ошибок

**Статус:** Полезная утилита, рекомендуется запускать перед коммитом

---

## Тестовые утилиты

### `test_improvements.py` - Тест улучшений

Тестовый скрипт для проверки функций keyword extraction и semantic chunking.

**Использование:**
```bash
python test_improvements.py
```

**Что проверяет:**
- Keyword extraction на примере текста
- Semantic chunking на длинном тексте
- Корректность работы на коротких текстах

**Статус:** Опциональный, можно удалить если не нужен

---

## Рекомендации по использованию

### Регулярное обслуживание

1. **Перед коммитом:**
   ```bash
   python check_imports.py
   ```

2. **После обновления кода:**
   ```bash
   python reindex_all.py
   ```

3. **При проблемах с именами каналов:**
   ```bash
   python fix_channels_db.py
   ```

4. **При рассинхронизации:**
   ```bash
   python sync_channel_status.py
   ```

### Массовые операции

Для массовой переиндексации всех каналов:
```bash
python reindex_all.py
```

Для проверки всех каналов:
```bash
python sync_channel_status.py
```

---

## Статус утилит

| Утилита | Статус | Когда использовать |
|---------|--------|-------------------|
| `reindex_all.py` | ✅ Рекомендуется | После обновления кода |
| `fix_channels_db.py` | ✅ Полезная | При проблемах с именами |
| `check_imports.py` | ✅ Рекомендуется | Перед коммитом |
| `sync_channel_status.py` | ✅ Полезная | При рассинхронизации |
| `delete_channel.py` | ✅ Полезная | Для удаления каналов |
| `test_improvements.py` | ⚠️ Опциональная | Для тестирования |

---

## Интеграция с основными командами

Все утилиты можно использовать вместе с основными командами:

```bash
# 1. Проверить систему
python check_imports.py

# 2. Исправить БД
python fix_channels_db.py

# 3. Переиндексировать все
python reindex_all.py

# 4. Проверить статус
python main.py status
```

